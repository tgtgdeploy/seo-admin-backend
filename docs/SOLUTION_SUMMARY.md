# âœ… è§£å†³æ–¹æ¡ˆæ€»ç»“ï¼šVercel ç½‘ç«™åšæ–‡ä¸ºç©ºçš„é—®é¢˜

---

## ğŸ¯ é—®é¢˜åˆ†æ

æ‚¨çš„ä¸‰ä¸ª Vercel ç½‘ç«™ï¼ˆseo-website-1, seo-website-2, seo-website-tgï¼‰å·²ç»éƒ¨ç½²ï¼Œä½†åšæ–‡æ˜¯ç©ºçš„ã€‚

**æ ¹æœ¬åŸå› **:
- Admin åå°çš„ API ç«¯ç‚¹éœ€è¦ç™»å½•è®¤è¯ï¼ˆNextAuth sessionï¼‰
- Vercel ç½‘ç«™æ— æ³•ç›´æ¥è°ƒç”¨è¿™äº›éœ€è¦è®¤è¯çš„ API
- ç¼ºå°‘å…¬å¼€çš„ã€åŸºäº API Key çš„ç«¯ç‚¹ä¾›å¤–éƒ¨è°ƒç”¨

---

## ğŸ› ï¸ å·²å®æ–½çš„è§£å†³æ–¹æ¡ˆ

### 1. åˆ›å»ºäº†å…¬å¼€ API ç«¯ç‚¹

**æ–°å¢æ–‡ä»¶**:
- `/app/api/public/posts/route.ts` - è·å–æ–‡ç« åˆ—è¡¨
- `/app/api/public/posts/[slug]/route.ts` - è·å–å•ç¯‡æ–‡ç« 
- `/lib/api-auth.ts` - API Key éªŒè¯å·¥å…·

**ç‰¹æ€§**:
- âœ… æ— éœ€ç™»å½•ï¼Œä½¿ç”¨ API Key è®¤è¯
- âœ… æ”¯æŒæŒ‰åŸŸåè¿‡æ»¤æ–‡ç« 
- âœ… åªè¿”å›å·²å‘å¸ƒï¼ˆPUBLISHEDï¼‰çš„æ–‡ç« 
- âœ… æ”¯æŒåˆ†é¡µï¼ˆlimit/offsetï¼‰
- âœ… å¯ç”¨ CORSï¼Œå…è®¸è·¨åŸŸè®¿é—®

---

### 2. æ·»åŠ äº† API Key ç®¡ç†åŠŸèƒ½

**æ•°æ®åº“æ›´æ–°**:
- åœ¨ `Website` æ¨¡å‹ä¸­æ·»åŠ äº† `apiKey` å­—æ®µ
- æ·»åŠ äº† `apiEnabled` å’Œ `isActive` æ ‡å¿—

**æ–°å¢æ–‡ä»¶**:
- `/lib/generate-api-key.ts` - API Key ç”Ÿæˆå·¥å…·
- `/app/api/websites/[id]/api-key/route.ts` - API Key ç®¡ç†ç«¯ç‚¹

**API Key æ ¼å¼**: `sk_live_<32ä½éšæœºå­—ç¬¦>`

---

### 3. æ›´æ–°äº†é¡¹ç›®é…ç½®

**Docker æ”¯æŒ**:
- âœ… `Dockerfile` - å¤šé˜¶æ®µæ„å»ºï¼Œä¼˜åŒ–é•œåƒå¤§å°
- âœ… `.dockerignore` - æ’é™¤ä¸å¿…è¦çš„æ–‡ä»¶
- âœ… `docker-compose.yml` - åŒ…å« PostgreSQLã€Redisã€Nginx

**PM2 é…ç½®**:
- âœ… `ecosystem.config.js` - è¿›ç¨‹ç®¡ç†é…ç½®
- âœ… è‡ªåŠ¨é‡å¯ã€æ—¥å¿—ç®¡ç†ã€å†…å­˜é™åˆ¶

**Next.js ä¼˜åŒ–**:
- âœ… å¯ç”¨ `output: 'standalone'` æ¨¡å¼ï¼ˆDocker å¿…éœ€ï¼‰
- âœ… å…³é—­ powered-by å¤´
- âœ… å¯ç”¨å‹ç¼©

**Workspace é…ç½®**:
- âœ… `pnpm-workspace.yaml` - å®šä¹‰ monorepo ç»“æ„

---

### 4. å®Œå–„çš„æ–‡æ¡£

**å·²åˆ›å»ºæ–‡æ¡£**:
1. **`/docs/API_INTEGRATION.md`** (é‡ç‚¹ï¼)
   - API ç«¯ç‚¹è¯¦ç»†è¯´æ˜
   - Next.js é›†æˆç¤ºä¾‹ä»£ç 
   - å®‰å…¨æœ€ä½³å®è·µ
   - æ•…éšœæ’æŸ¥æŒ‡å—

2. **`/docs/QUICK_START.md`**
   - 10 åˆ†é’Ÿå¿«é€Ÿé…ç½®æŒ‡å—
   - åˆ†æ­¥éª¤æ“ä½œè¯´æ˜
   - å®Œæ•´çš„æ£€æŸ¥æ¸…å•

3. **`/docs/SOLUTION_SUMMARY.md`** (æœ¬æ–‡æ¡£)
   - é—®é¢˜åˆ†æå’Œè§£å†³æ–¹æ¡ˆæ€»ç»“

---

## ğŸš€ ç«‹å³è¡ŒåŠ¨ï¼š3 æ­¥è§£å†³åšæ–‡ä¸ºç©ºé—®é¢˜

### Step 1: æ›´æ–°æ•°æ®åº“æ¶æ„

```bash
cd /home/ubuntu/WebstormProjects/seo-admin

# ç”Ÿæˆ Prisma Client
pnpm run db:generate

# æ¨é€åˆ°æ•°æ®åº“
pnpm run db:push
```

### Step 2: é‡å¯ Admin åå°

```bash
# æ„å»ºæœ€æ–°ä»£ç 
pnpm run build

# é‡å¯ PM2ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
pm2 restart seo-admin

# æˆ–ç›´æ¥è¿è¡Œ
pnpm run start
```

### Step 3: ç”Ÿæˆ API Key å¹¶é…ç½® Vercel

1. **ç™»å½• Admin åå°** â†’ è¿›å…¥ Websites é¡µé¢
2. **ä¸ºæ¯ä¸ªç½‘ç«™ç”Ÿæˆ API Key**ï¼ˆç‚¹å‡» Generate API Key æŒ‰é’®ï¼‰
3. **å¤åˆ¶ API Key**ï¼ˆæ ¼å¼ï¼š`sk_live_YOUR_KEY`ï¼‰
4. **åœ¨ Vercel é…ç½®ç¯å¢ƒå˜é‡**:
   ```bash
   NEXT_PUBLIC_ADMIN_API_URL=https://admin.yourdomain.com:3100
   ADMIN_API_KEY=sk_live_YOUR_API_KEY_HERE
   NEXT_PUBLIC_SITE_DOMAIN=seo-website-1.vercel.app
   ```
5. **é‡æ–°éƒ¨ç½² Vercel ç½‘ç«™**

---

## ğŸ“ é¡¹ç›®æ–‡ä»¶å˜æ›´æ¸…å•

### æ–°å¢æ–‡ä»¶ (13 ä¸ª)

```
âœ… pnpm-workspace.yaml              # Workspace é…ç½®
âœ… Dockerfile                       # Docker é•œåƒæ„å»º
âœ… .dockerignore                    # Docker å¿½ç•¥æ–‡ä»¶
âœ… docker-compose.yml               # Docker Compose é…ç½®
âœ… ecosystem.config.js              # PM2 é…ç½®

âœ… lib/api-auth.ts                  # API Key éªŒè¯
âœ… lib/generate-api-key.ts          # API Key ç”Ÿæˆå™¨

âœ… app/api/public/posts/route.ts                    # å…¬å¼€ APIï¼šæ–‡ç« åˆ—è¡¨
âœ… app/api/public/posts/[slug]/route.ts             # å…¬å¼€ APIï¼šå•ç¯‡æ–‡ç« 
âœ… app/api/websites/[id]/api-key/route.ts           # API Key ç®¡ç†

âœ… docs/API_INTEGRATION.md          # API é›†æˆæŒ‡å—
âœ… docs/QUICK_START.md              # å¿«é€Ÿå¼€å§‹
âœ… docs/SOLUTION_SUMMARY.md         # è§£å†³æ–¹æ¡ˆæ€»ç»“
```

### ä¿®æ”¹æ–‡ä»¶ (2 ä¸ª)

```
ğŸ“ next.config.js                   # æ·»åŠ  standalone è¾“å‡º
ğŸ“ packages/database/prisma/schema.prisma  # æ·»åŠ  apiKey å­—æ®µ
```

---

## ğŸ§ª æµ‹è¯• API

### æœ¬åœ°æµ‹è¯•

```bash
# 1. ç¡®ä¿ Admin è¿è¡Œåœ¨ç«¯å£ 3100
curl http://localhost:3100/api/public/posts?domain=test.com \
  -H 'x-api-key: sk_live_your_key_here'

# 2. åº”è¯¥è¿”å› JSON æ ¼å¼çš„æ–‡ç« åˆ—è¡¨
```

### Vercel ç½‘ç«™é›†æˆä»£ç ç¤ºä¾‹

```typescript
// lib/api.ts
export async function getPosts() {
  const response = await fetch(
    `${process.env.NEXT_PUBLIC_ADMIN_API_URL}/api/public/posts?domain=${process.env.NEXT_PUBLIC_SITE_DOMAIN}`,
    {
      headers: {
        'x-api-key': process.env.ADMIN_API_KEY!,
      },
      next: { revalidate: 60 }, // ISR: æ¯åˆ†é’Ÿé‡æ–°éªŒè¯
    }
  )
  return response.json()
}
```

---

## ğŸ¨ æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     SEO Admin (VPS)                 â”‚
â”‚     http://admin.yourdomain.com     â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   PostgreSQL Database       â”‚   â”‚
â”‚  â”‚   - websites                â”‚   â”‚
â”‚  â”‚   - posts (PUBLISHED)       â”‚   â”‚
â”‚  â”‚   - apiKey auth             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Public API Endpoints      â”‚   â”‚
â”‚  â”‚   /api/public/posts         â”‚â—„â”€â”€â”¼â”€â”€â”€ API Key Authentication
â”‚  â”‚   /api/public/posts/[slug]  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ HTTPS + API Key
               â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                                 â”‚
      â–¼                                 â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ seo-website-1   â”‚         â”‚ seo-website-2   â”‚         â”‚ seo-website-tg  â”‚
â”‚   (Vercel)      â”‚         â”‚   (Vercel)      â”‚         â”‚   (Vercel)      â”‚
â”‚                 â”‚         â”‚                 â”‚         â”‚                 â”‚
â”‚ NEXT_PUBLIC_    â”‚         â”‚ NEXT_PUBLIC_    â”‚         â”‚ NEXT_PUBLIC_    â”‚
â”‚ ADMIN_API_URL   â”‚         â”‚ ADMIN_API_URL   â”‚         â”‚ ADMIN_API_URL   â”‚
â”‚ ADMIN_API_KEY   â”‚         â”‚ ADMIN_API_KEY   â”‚         â”‚ ADMIN_API_KEY   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                                 â”‚                                 â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                  End Users
                (çœ‹åˆ°åšæ–‡å†…å®¹)
```

---

## ğŸ”’ å®‰å…¨è¦ç‚¹

### âœ… å·²å®æ–½çš„å®‰å…¨æªæ–½

1. **API Key è®¤è¯**: é˜²æ­¢æœªæˆæƒè®¿é—®
2. **HTTPS ä¼ è¾“**: ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ï¼ˆå¾…é…ç½®ï¼‰
3. **åªè¿”å›å·²å‘å¸ƒæ–‡ç« **: è‰ç¨¿ä¸ä¼šæ³„éœ²
4. **CORS é…ç½®**: æ”¯æŒè·¨åŸŸä½†å¯é™åˆ¶åŸŸå
5. **æœåŠ¡å™¨ç«¯è°ƒç”¨**: API Key ä¸æš´éœ²ç»™å®¢æˆ·ç«¯

### âš ï¸ éœ€è¦æ³¨æ„

- ä¸è¦åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­æš´éœ² `ADMIN_API_KEY`
- ä½¿ç”¨ Server Components æˆ– API Routes è°ƒç”¨
- å®šæœŸè½®æ¢ API Keyï¼ˆæ¯ 3-6 ä¸ªæœˆï¼‰
- ç›‘æ§ API è°ƒç”¨æ—¥å¿—

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **ä½¿ç”¨ ISRï¼ˆå¢é‡é™æ€å†ç”Ÿæˆï¼‰**
   ```typescript
   fetch(url, { next: { revalidate: 60 } })
   ```

2. **å¯ç”¨ç¼“å­˜**: Vercel Edge Cache è‡ªåŠ¨ç¼“å­˜å“åº”

3. **CDN åŠ é€Ÿ**: å›¾ç‰‡å’Œé™æ€èµ„æºä½¿ç”¨ CDN

4. **åˆ†é¡µåŠ è½½**: å¤§é‡æ–‡ç« æ—¶ä½¿ç”¨åˆ†é¡µ

---

## ğŸ“š ä¸‹ä¸€æ­¥æ“ä½œ

### ç«‹å³æ‰§è¡Œï¼ˆå¿…éœ€ï¼‰

- [ ] è¿è¡Œ `pnpm run db:push` æ›´æ–°æ•°æ®åº“
- [ ] é‡å¯ Admin åå°
- [ ] ä¸ºä¸‰ä¸ªç½‘ç«™ç”Ÿæˆ API Key
- [ ] åœ¨ Vercel é…ç½®ç¯å¢ƒå˜é‡
- [ ] åˆ›å»ºè‡³å°‘ 3 ç¯‡æµ‹è¯•æ–‡ç« ï¼ˆstatus=PUBLISHEDï¼‰
- [ ] æµ‹è¯• API è°ƒç”¨
- [ ] éªŒè¯ Vercel ç½‘ç«™æ˜¾ç¤ºæ–‡ç« 

### åç»­ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

- [ ] é…ç½® Nginx åå‘ä»£ç†
- [ ] ä¸º Admin å¯ç”¨ HTTPS
- [ ] è®¾ç½® Cloudflare CDN
- [ ] é…ç½®è‡ªåŠ¨å¤‡ä»½
- [ ] æ·»åŠ  API è®¿é—®æ—¥å¿—ç›‘æ§
- [ ] å®ç° Webhook è‡ªåŠ¨è§¦å‘ Vercel é‡æ–°éƒ¨ç½²

---

## ğŸ†˜ é‡åˆ°é—®é¢˜ï¼Ÿ

### æŸ¥çœ‹æ—¥å¿—

```bash
# Admin åå°æ—¥å¿—
pm2 logs seo-admin

# æ•°æ®åº“è¿æ¥æµ‹è¯•
pnpm run db:studio

# æµ‹è¯• API
curl http://localhost:3100/api/public/posts?domain=test.com \
  -H 'x-api-key: sk_live_YOUR_KEY'
```

### å¸¸è§é—®é¢˜è§£å†³

1. **401 Unauthorized** â†’ æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®
2. **è¿”å›ç©ºæ•°ç»„** â†’ æ£€æŸ¥æ•°æ®åº“æ˜¯å¦æœ‰ PUBLISHED æ–‡ç« 
3. **CORS é”™è¯¯** â†’ API å·²é…ç½® CORSï¼Œæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°
4. **è¿æ¥è¶…æ—¶** â†’ æ£€æŸ¥é˜²ç«å¢™å’Œç«¯å£æ˜¯å¦å¼€æ”¾

---

## ğŸ“ è”ç³»æ”¯æŒ

- è¯¦ç»†æ–‡æ¡£: `/docs/API_INTEGRATION.md`
- å¿«é€Ÿå¼€å§‹: `/docs/QUICK_START.md`
- ç¤ºä¾‹ä»£ç : è§ API_INTEGRATION.md

---

**åˆ›å»ºæ—¶é—´**: 2024-01-15
**çŠ¶æ€**: âœ… å·²å®Œæˆ
**æµ‹è¯•çŠ¶æ€**: â³ å¾…æµ‹è¯•
**é¢„è®¡è§£å†³æ—¶é—´**: 15 åˆ†é’Ÿ
