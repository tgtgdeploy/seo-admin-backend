# âš¡ å®å¡”å¿«é€Ÿéƒ¨ç½² - 5 åˆ†é’Ÿä¸Šçº¿

ä»æ‹‰å–ä»“åº“åˆ°è¿è¡ŒæˆåŠŸï¼Œåªéœ€ 5 ä¸ªå‘½ä»¤ï¼

---

## ğŸ“‹ å‰ææ¡ä»¶

ç¡®ä¿å®å¡”é¢æ¿å·²å®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼š
- âœ… **PostgreSQL 14+**ï¼ˆæ•°æ®åº“ â†’ PostgreSQL â†’ å®‰è£…ï¼‰
- âœ… **PM2 ç®¡ç†å™¨**ï¼ˆè½¯ä»¶å•†åº— â†’ PM2 ç®¡ç†å™¨ â†’ å®‰è£…ï¼‰
- âœ… **Nginx**ï¼ˆè½¯ä»¶å•†åº— â†’ Nginx â†’ å®‰è£…ï¼‰
- âœ… **Node.js 20**ï¼ˆè½¯ä»¶å•†åº— â†’ Node.js ç‰ˆæœ¬ç®¡ç†å™¨ â†’ å®‰è£… v20ï¼‰

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆ5 æ­¥ï¼‰

### Step 1: æ‹‰å–ä»£ç 

æ‰“å¼€å®å¡” **ç»ˆç«¯**ï¼š

```bash
# è¿›å…¥ç½‘ç«™ç›®å½•
cd /www/wwwroot

# å…‹éš†ä»“åº“
git clone https://github.com/tgtgdeploy/seo-admin-backend.git seo-admin

# è¿›å…¥é¡¹ç›®
cd seo-admin
```

---

### Step 2: åˆ›å»ºæ•°æ®åº“

**å®å¡”é¢æ¿æ“ä½œ**ï¼š
1. ç‚¹å‡» **æ•°æ®åº“** â†’ **PostgreSQL**
2. ç‚¹å‡» **æ·»åŠ æ•°æ®åº“**
3. å¡«å†™ï¼š
   - æ•°æ®åº“åï¼š`seo_admin`
   - ç”¨æˆ·åï¼š`seo_admin`
   - å¯†ç ï¼š`seo123456`ï¼ˆè®°ä½è¿™ä¸ªå¯†ç ï¼‰
4. ç‚¹å‡» **æäº¤**

---

### Step 3: é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp .env.example .env.local

# ç¼–è¾‘é…ç½®ï¼ˆä½¿ç”¨ vi æˆ–å®å¡”æ–‡ä»¶ç®¡ç†å™¨ï¼‰
vi .env.local
```

**æœ€å°é…ç½®**ï¼ˆæŒ‰ `i` è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼‰ï¼š

```bash
# æ•°æ®åº“è¿æ¥ï¼ˆä¿®æ”¹å¯†ç ä¸ºæ‚¨åˆšæ‰è®¾ç½®çš„ï¼‰
DATABASE_URL="postgresql://seo_admin:seo123456@localhost:5432/seo_admin"

# è®¤è¯å¯†é’¥ï¼ˆéšæœºå­—ç¬¦ä¸²ï¼Œ32ä½ä»¥ä¸Šï¼‰
NEXTAUTH_SECRET="change-this-to-random-32-chars-min"
NEXTAUTH_URL="http://ä½ çš„æœåŠ¡å™¨IP:3100"

# åŠ å¯†å¯†é’¥ï¼ˆ32ä½ï¼‰
SETTINGS_ENCRYPTION_KEY="change-this-to-32-characters-"
```

ä¿å­˜ï¼šæŒ‰ `Esc` â†’ è¾“å…¥ `:wq` â†’ æŒ‰ `Enter`

**ç”Ÿæˆéšæœºå¯†é’¥**ï¼ˆå¯é€‰ï¼Œæ¨èï¼‰ï¼š
```bash
# ç”Ÿæˆ NEXTAUTH_SECRET
openssl rand -base64 32

# ç”Ÿæˆ SETTINGS_ENCRYPTION_KEY
openssl rand -hex 16
```

---

### Step 4: å®‰è£…å¹¶æ„å»º

```bash
# å®‰è£… pnpmï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
npm install -g pnpm@8.15.0

# å®‰è£…ä¾èµ–ï¼ˆéœ€è¦ 5-10 åˆ†é’Ÿï¼‰
pnpm install

# åˆå§‹åŒ–æ•°æ®åº“
pnpm run db:generate
pnpm run db:push

# æ„å»ºé¡¹ç›®ï¼ˆéœ€è¦ 3-5 åˆ†é’Ÿï¼‰
pnpm run build
```

---

### Step 5: å¯åŠ¨åº”ç”¨

#### æ–¹å¼ A: ä½¿ç”¨å®å¡” PM2 ç®¡ç†å™¨ï¼ˆæ¨èï¼‰

1. æ‰“å¼€å®å¡”é¢æ¿ â†’ **è½¯ä»¶å•†åº—** â†’ **PM2 ç®¡ç†å™¨** â†’ **è®¾ç½®**
2. ç‚¹å‡» **æ·»åŠ é¡¹ç›®**
3. å¡«å†™ï¼š

```
é¡¹ç›®åç§°: seo-admin
è¿è¡Œç›®å½•: /www/wwwroot/seo-admin
å¯åŠ¨æ–‡ä»¶: node_modules/.bin/next
å¯åŠ¨å‚æ•°: start --port 3100
```

4. ç‚¹å‡» **æäº¤** â†’ ç‚¹å‡» **å¯åŠ¨**

#### æ–¹å¼ B: å‘½ä»¤è¡Œå¯åŠ¨

```bash
# ä½¿ç”¨ PM2 å¯åŠ¨
pm2 start ecosystem.config.js

# ä¿å­˜ PM2 é…ç½®
pm2 save
pm2 startup
```

---

## âœ… éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹è¿›ç¨‹
pm2 list

# åº”è¯¥çœ‹åˆ° seo-admin çŠ¶æ€ä¸º online
```

### 2. æµ‹è¯• API

```bash
curl http://localhost:3100/api/health
```

åº”è¯¥è¿”å›ï¼š
```json
{"status":"healthy","database":"connected",...}
```

### 3. æµè§ˆå™¨è®¿é—®

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://ä½ çš„æœåŠ¡å™¨IP:3100`

åº”è¯¥çœ‹åˆ°ç™»å½•é¡µé¢ï¼

---

## ğŸŒ é…ç½®åŸŸåè®¿é—®ï¼ˆå¯é€‰ä½†æ¨èï¼‰

### æ–¹å¼ 1: ç›´æ¥è®¿é—®ï¼ˆç®€å•ï¼Œé€‚åˆæµ‹è¯•ï¼‰

**å¼€æ”¾é˜²ç«å¢™ç«¯å£**ï¼š
1. å®å¡”é¢æ¿ â†’ **å®‰å…¨**
2. æ·»åŠ ç«¯å£ï¼š`3100`
3. ç‚¹å‡» **æ”¾è¡Œ**

ç°åœ¨å¯ä»¥é€šè¿‡ `http://ä½ çš„IP:3100` è®¿é—®

### æ–¹å¼ 2: Nginx åå‘ä»£ç†ï¼ˆæ¨èï¼Œé€‚åˆç”Ÿäº§ï¼‰

#### 2.1 åˆ›å»ºç½‘ç«™

1. å®å¡”é¢æ¿ â†’ **ç½‘ç«™** â†’ **æ·»åŠ ç«™ç‚¹**
2. å¡«å†™ï¼š
   - åŸŸåï¼š`admin.yourdomain.com`ï¼ˆæˆ–ç›´æ¥ç”¨ IPï¼‰
   - æ ¹ç›®å½•ï¼š`/www/wwwroot/seo-admin`
   - PHPï¼šçº¯é™æ€
3. ç‚¹å‡» **æäº¤**

#### 2.2 é…ç½®åå‘ä»£ç†

1. æ‰¾åˆ°åˆšåˆ›å»ºçš„ç½‘ç«™ â†’ **è®¾ç½®**
2. ç‚¹å‡» **åå‘ä»£ç†** â†’ **æ·»åŠ åå‘ä»£ç†**
3. å¡«å†™ï¼š
   - ä»£ç†åç§°ï¼š`seo-admin`
   - ç›®æ ‡ URLï¼š`http://127.0.0.1:3100`
   - å‘é€åŸŸåï¼š`$host`
4. ç‚¹å‡» **æäº¤**

#### 2.3 é…ç½® SSLï¼ˆå¯é€‰ï¼‰

1. ç½‘ç«™è®¾ç½® â†’ **SSL**
2. é€‰æ‹© **Let's Encrypt**
3. å‹¾é€‰åŸŸå â†’ ç‚¹å‡» **ç”³è¯·**
4. å¼€å¯ **å¼ºåˆ¶ HTTPS**

ç°åœ¨å¯ä»¥é€šè¿‡ `https://admin.yourdomain.com` è®¿é—®ï¼

---

## ğŸ¯ ç™»å½•åå°

**é»˜è®¤è´¦å·**ï¼ˆä½¿ç”¨ç§å­æ•°æ®ï¼‰ï¼š
- é‚®ç®±ï¼š`admin@example.com`
- å¯†ç ï¼šæŸ¥çœ‹ `packages/database/prisma/seed.ts`

**æˆ–åˆ›å»ºæ–°è´¦å·**ï¼š
```bash
cd /www/wwwroot/seo-admin
pnpm run db:studio

# åœ¨æµè§ˆå™¨æ‰“å¼€ http://localhost:5555
# æ‰‹åŠ¨æ·»åŠ  User è®°å½•
```

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### æŸ¥çœ‹æ—¥å¿—
```bash
pm2 logs seo-admin --lines 100
```

### é‡å¯åº”ç”¨
```bash
pm2 restart seo-admin
```

### æ›´æ–°ä»£ç 
```bash
cd /www/wwwroot/seo-admin
git pull
pnpm install
pnpm run db:push  # å¦‚æœæ•°æ®åº“æœ‰æ›´æ–°
pnpm run build
pm2 restart seo-admin
```

### åœæ­¢åº”ç”¨
```bash
pm2 stop seo-admin
```

### åˆ é™¤åº”ç”¨
```bash
pm2 delete seo-admin
```

---

## ğŸš¨ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: `pnpm: command not found`

**è§£å†³**ï¼š
```bash
npm install -g pnpm@8.15.0
```

### é—®é¢˜ 2: æ•°æ®åº“è¿æ¥å¤±è´¥

**æ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥ PostgreSQL æ˜¯å¦è¿è¡Œ
systemctl status postgresql

# æµ‹è¯•è¿æ¥
psql -U seo_admin -d seo_admin -h localhost
```

**å¦‚æœæç¤ºå¯†ç é”™è¯¯**ï¼Œæ£€æŸ¥ `.env.local` ä¸­çš„ `DATABASE_URL` å¯†ç æ˜¯å¦æ­£ç¡®ã€‚

### é—®é¢˜ 3: ç«¯å£è¢«å ç”¨

**æ£€æŸ¥å ç”¨**ï¼š
```bash
netstat -tuln | grep 3100
```

**æ€æ­»è¿›ç¨‹**ï¼š
```bash
lsof -ti:3100 | xargs kill -9
```

### é—®é¢˜ 4: PM2 å¯åŠ¨å¤±è´¥

**æŸ¥çœ‹é”™è¯¯æ—¥å¿—**ï¼š
```bash
pm2 logs seo-admin --err --lines 50
```

**å¸¸è§åŸå› **ï¼š
- `.env.local` é…ç½®é”™è¯¯ â†’ æ£€æŸ¥æ•°æ®åº“ URL
- æ¨¡å—æœªå®‰è£… â†’ é‡æ–°è¿è¡Œ `pnpm install`
- æ„å»ºå¤±è´¥ â†’ é‡æ–°è¿è¡Œ `pnpm run build`

### é—®é¢˜ 5: æ— æ³•è®¿é—®ç½‘ç«™

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] PM2 åº”ç”¨æ˜¯å¦è¿è¡Œï¼ˆ`pm2 list`ï¼‰
- [ ] é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ç«¯å£ï¼ˆå®å¡”å®‰å…¨ â†’ ç«¯å£ 3100ï¼‰
- [ ] Nginx æ˜¯å¦è¿è¡Œï¼ˆ`systemctl status nginx`ï¼‰
- [ ] åŸŸåæ˜¯å¦è§£æåˆ°æœåŠ¡å™¨ IP

---

## ğŸ“Š éƒ¨ç½²æˆåŠŸæ ‡å¿—

âœ… **æ£€æŸ¥æ¸…å•**ï¼š
- [ ] `pm2 list` æ˜¾ç¤º seo-admin çŠ¶æ€ä¸º `online`
- [ ] `curl http://localhost:3100/api/health` è¿”å› `{"status":"healthy"}`
- [ ] æµè§ˆå™¨å¯ä»¥è®¿é—®ç™»å½•é¡µé¢
- [ ] å¯ä»¥æˆåŠŸç™»å½•åå°
- [ ] æ•°æ®åº“ä¸­æœ‰æ•°æ®ï¼ˆ`pnpm run db:studio`ï¼‰

---

## ğŸ‰ éƒ¨ç½²å®Œæˆï¼

**æ‚¨çš„ Admin åå°å·²æˆåŠŸéƒ¨ç½²ï¼**

### ä¸‹ä¸€æ­¥ï¼š

1. **ç”Ÿæˆ API Key**
   - ç™»å½•åå° â†’ Websites â†’ åˆ›å»ºç½‘ç«™ â†’ ç”Ÿæˆ API Key

2. **é…ç½® Vercel ç½‘ç«™**
   - åœ¨ Vercel é¡¹ç›®ä¸­æ·»åŠ ç¯å¢ƒå˜é‡ï¼š
     ```bash
     NEXT_PUBLIC_ADMIN_API_URL=http://ä½ çš„IP:3100
     ADMIN_API_KEY=sk_live_xxxxx
     NEXT_PUBLIC_SITE_DOMAIN=your-site.vercel.app
     ```

3. **å‘å¸ƒæ–‡ç« **
   - åå° â†’ Posts â†’ New Post â†’ å¡«å†™å†…å®¹ â†’ Status: Published â†’ Save

4. **æµ‹è¯• Vercel ç½‘ç«™**
   - è®¿é—® `https://your-site.vercel.app/blog`
   - åº”è¯¥èƒ½çœ‹åˆ°æ–‡ç« åˆ—è¡¨ï¼

---

### ğŸ“š è¯¦ç»†æ–‡æ¡£

- å®Œæ•´å®å¡”éƒ¨ç½²æŒ‡å—ï¼š[BAOTA_DEPLOYMENT.md](./docs/BAOTA_DEPLOYMENT.md)
- API é›†æˆæ–‡æ¡£ï¼š[API_INTEGRATION.md](./docs/API_INTEGRATION.md)
- å®Œæ•´éƒ¨ç½²æ¸…å•ï¼š[DEPLOY_CHECKLIST.md](./DEPLOY_CHECKLIST.md)

---

**éƒ¨ç½²æ—¶é—´**: 10-15 åˆ†é’Ÿ
**éš¾åº¦**: â­â­â˜†â˜†â˜†

æœ‰é—®é¢˜ï¼ŸæŸ¥çœ‹æ—¥å¿—ï¼š`pm2 logs seo-admin`
